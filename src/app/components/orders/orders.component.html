<div class="container-fluid mt-4">
  <div class="header">
    <h1>PEDIDOS</h1>
    <button (click)="toggleForm()" class="btn create-button">+ Crear</button>
  </div>
  <div *ngIf="showForm" class="form-and-list-container">
    <!-- Formulario de Pedido -->
    <div class="order-form">
      <form (ngSubmit)="addOrder()">
        <h3>Nuevo Pedido</h3>
        <div class="form-row">
          <div class="form-group">
            <p-iftalabel class="w-full md:w-56">
              <p-select
                [options]="materials"
                [(ngModel)]="newOrder.material"
                placeholder="Seleccione un Material"
                [editable]="true"
                optionLabel="name"
                optionValue="name"
                name="material"
                id="material"
                class="w-full md:w-56"
              ></p-select>
              <label for="material">Material</label>
            </p-iftalabel>
          </div>
          <div class="form-group">
            <p-iftalabel>
              <p-inputnumber
                [(ngModel)]="newOrder.cantidad"
                inputId="cantidad"
                required
                name="cantidad"
                id="cantidad"
              ></p-inputnumber>
              <label for="cantidad">Cantidad</label>
            </p-iftalabel>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <p-iftalabel>
              <input
                pInputText
                id="observacion"
                [(ngModel)]="newOrder.observacion"
                name="observacion"
              />
              <label for="observacion">Observación</label>
            </p-iftalabel>
          </div>
          <div class="form-group">
            <p-iftalabel>
              <p-datepicker
                [(ngModel)]="newOrder.fechaSolicitada"
                [iconDisplay]="'input'"
                [showIcon]="true"
                name="fechaSolicitada"
                id="fechaSolicitada"
                inputId="icondisplay"
              />
              <label for="fechaSolicitada">Fecha Solicita</label>
            </p-iftalabel>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <p-iftalabel>
              <input
                pInputText
                id="paqueteTrabajo"
                [(ngModel)]="newOrder.paqueteTrabajo"
                name="paqueteTrabajo"
              />
              <label for="paqueteTrabajo">Paquete de trabajo</label>
            </p-iftalabel>
          </div>
          <div class="form-group">
            <p-iftalabel class="w-full md:w-56">
              <p-select
                [options]="tecnicos"
                [(ngModel)]="newOrder.tecnico"
                placeholder="Seleccione un Técnico"
                [editable]="true"
                optionLabel="name"
                optionValue="name"
                name="tecnico"
                id="tecnico"
                class="w-full md:w-56"
              ></p-select>
              <label for="material">Técnico Responsable</label>
            </p-iftalabel>
          </div>
        </div>
        <div class="form-buttons">
          <button type="submit" class="btn submit-button">
            Agregar Pedido
          </button>
          <button
            type="button"
            (click)="cancelOrder()"
            class="btn cancel-button"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Lista de Pedidos NUEVA-->
    <p-table
      [value]="pedidosList"
      dataKey="id"
      editMode="row"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template #header>
        <tr>
          <th style="width: 20%">Material</th>
          <th style="width: 20%">Cantidad</th>
          <th style="width: 20%">Observación</th>
          <th style="width: 20%">Fecha Solicitada</th>
          <th style="width: 20%">Paquete de Trabajo</th>
          <th style="width: 20%">Técnico</th>
          <th style="width: 20%">Acciones</th>
        </tr>
      </ng-template>
      <ng-template #body let-product let-editing="editing" let-ri="rowIndex">
        <tr [pEditableRow]="product">
          <td>{{ product.material }}</td>
          <td>
            <p-cellEditor>
              <ng-template #input>
                <input
                  pInputText
                  type="text"
                  [(ngModel)]="product.cantidad"
                  required
                />
              </ng-template>
              <ng-template #output>
                {{ product.cantidad }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>{{ product.observacion }}</td>
          <td>{{ product.fechaSolicitada }}</td>
          <td>{{ product.paqueteTrabajo }}</td>
          <td>{{ product.tecnico }}</td>
          <td>
            <div class="flex items-center justify-center gap-2">
              <button
                *ngIf="!editing"
                pButton
                pRipple
                type="button"
                pInitEditableRow
                icon="pi pi-pencil"
                (click)="onRowEditInit(product)"
                text
                rounded
                severity="secondary"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pSaveEditableRow
                icon="pi pi-check"
                (click)="onRowEditSave(product)"
                text
                rounded
                severity="secondary"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pCancelEditableRow
                icon="pi pi-times"
                (click)="onRowEditCancel(product, ri)"
                text
                rounded
                severity="secondary"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <p-table
    #dt1
    [value]="orders"
    dataKey="id"
    [rows]="10"
    [rowsPerPageOptions]="[10, 25, 50]"
    [loading]="loading"
    [paginator]="true"
    stripedRows
    [tableStyle]="{ 'min-width': '50rem' }"
    [globalFilterFields]="[
      'udf',
      'MaterialSolicitado',
      'Cantidad',
      'Observacion',
      'Fechasolicitada',
      'PaquetedeTrabajo',
      'TecnicoResponsable',
      'StatusEntrega',
      'Bodega',
      'Codigo',
      'Fechadeentrega',
      'CantidadEntregada',
      'id'
    ]"
    [tableStyle]="{ 'min-width': '75rem' }"
  >
    <ng-template #caption>
      <div class="flex">
        <p-iconfield iconPosition="left" class="ml-auto">
          <p-inputicon>
            <i class="pi pi-search"></i>
          </p-inputicon>
          <input
            pInputText
            type="text"
            (input)="applyFilterGlobal($event, 'contains')"
            placeholder="Buscar"
          />
        </p-iconfield>
      </div>
    </ng-template>
    <ng-template #header>
      <tr>
        <th pSortableColumn="id" style="width: 22%">
          ID <p-sortIcon field="id" />
        </th>
        <th pSortableColumn="udf" style="width: 22%">
          UDF <p-sortIcon field="udf" />
        </th>
        <th pSortableColumn="Bodega" style="width: 22%">
          Bodega <p-sortIcon field="Bodega" />
        </th>
        <th pSortableColumn="Cantidad" style="width: 22%">
          Cantidad <p-sortIcon field="Cantidad" />
        </th>
        <th pSortableColumn="CantidadEntregada" style="width: 22%">
          Cantidad Entregada <p-sortIcon field="CantidadEntregada" />
        </th>
        <th pSortableColumn="Codigo" style="width: 22%">
          Código <p-sortIcon field="Codigo" />
        </th>
        <th pSortableColumn="Fechadeentrega" style="width: 22%">
          Fecha de entrega <p-sortIcon field="Fechadeentrega" />
        </th>
        <th pSortableColumn="Fechasolicitada" style="width: 22%">
          Fecha solicitada <p-sortIcon field="Fechasolicitada" />
        </th>
      </tr>
      <tr>
        <th>
          <p-columnFilter
            type="text"
            field="id"
            ariaLabel="Filter Name"
            (input)="applyColumnFilter($event, 'id')"
          ></p-columnFilter>
        </th>
        <th>
          <p-columnFilter
            type="text"
            field="udf"
            ariaLabel="Filter Country"
            (input)="applyColumnFilter($event, 'udf')"
          ></p-columnFilter>
        </th>
        <th>
          <p-columnFilter
            type="text"
            field="Bodega"
            ariaLabel="Filter Country"
            (input)="applyColumnFilter($event, 'Bodega')"
          ></p-columnFilter>
        </th>
        <th>
          <p-columnFilter
            type="text"
            field="Cantidad"
            ariaLabel="Filter Country"
            (input)="applyColumnFilter($event, 'Cantidad')"
          ></p-columnFilter>
        </th>
        <th>
          <p-columnFilter
            type="text"
            field="CantidadEntregada"
            ariaLabel="Filter Country"
            (input)="applyColumnFilter($event, 'CantidadEntregada')"
          ></p-columnFilter>
        </th>
        <th>
          <p-columnFilter
            type="text"
            field="Codigo"
            ariaLabel="Filter Country"
            (input)="applyColumnFilter($event, 'Codigo')"
          ></p-columnFilter>
        </th>
        <th>
          <p-columnFilter
            type="text"
            field="Fechadeentrega"
            ariaLabel="Filter Country"
            (input)="applyColumnFilter($event, 'Fechadeentrega')"
          ></p-columnFilter>
        </th>
        <th>
          <p-columnFilter
            type="text"
            field="Fechasolicitada"
            ariaLabel="Filter Country"
            (input)="applyColumnFilter($event, 'Fechasolicitada')"
          ></p-columnFilter>
        </th>
      </tr>
    </ng-template>
    <ng-template #body let-orders>
      <tr>
        <td>
          {{ orders.id }}
        </td>
        <td>
          {{ orders.udf }}
        </td>
        <td>
          {{ orders.Bodega }}
        </td>
        <td>
          {{ orders.Cantidad }}
        </td>
        <td>
          {{ orders.CantidadEntregada }}
        </td>
        <td>
          {{ orders.Codigo }}
        </td>
        <td>
          {{ orders.Fechadeentrega }}
        </td>
        <td>
          {{ orders.Fechasolicitada }}
        </td>
      </tr>
    </ng-template>
    <ng-template #emptymessage>
      <tr>
        <td colspan="5">No se encontraron registros.</td>
      </tr>
    </ng-template>
  </p-table>
</div>
