<div class="container-fluid mt-4">
  <div class="header">
    <h1>PEDIDOS</h1>
    <button (click)="toggleForm()" class="btn create-button">+ Crear</button>
  </div>
  <div *ngIf="showForm" class="form-and-list-container">
    <!-- Formulario de Pedido -->
    <div class="order-form">
      <form (ngSubmit)="addOrder()">
        <h3>Nuevo Pedido</h3>
        <div class="form-row">
          <div class="form-group">
            <p-iftalabel class="w-full md:w-56">
              <p-select
                [options]="materials"
                [(ngModel)]="newOrder.material"
                placeholder="Seleccione un Material"
                [editable]="true"
                optionLabel="name"
                optionValue="name"
                name="material"
                id="material"
                class="w-full md:w-56"
              ></p-select>
              <label for="material">Material</label>
            </p-iftalabel>
          </div>
          <div class="form-group">
            <p-iftalabel>
              <p-inputnumber
                [(ngModel)]="newOrder.cantidad"
                inputId="cantidad"
                required
                name="cantidad"
                id="cantidad"
              ></p-inputnumber>
              <label for="cantidad">Cantidad</label>
            </p-iftalabel>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <p-iftalabel>
              <input
                pInputText
                id="observacion"
                [(ngModel)]="newOrder.observacion"
                name="observacion"
              />
              <label for="observacion">Observación</label>
            </p-iftalabel>
          </div>
          <div class="form-group">
            <p-iftalabel>
              <p-datepicker
                [(ngModel)]="newOrder.fechaSolicitada"
                [iconDisplay]="'input'"
                [showIcon]="true"
                name="fechaSolicitada"
                id="fechaSolicitada"
                inputId="icondisplay"
              />
              <label for="fechaSolicitada">Fecha Solicita</label>
            </p-iftalabel>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <p-iftalabel>
              <input
                pInputText
                id="paqueteTrabajo"
                [(ngModel)]="newOrder.paqueteTrabajo"
                name="paqueteTrabajo"
              />
              <label for="paqueteTrabajo">Paquete de trabajo</label>
            </p-iftalabel>
          </div>
          <div class="form-group">
            <p-iftalabel class="w-full md:w-56">
              <p-select
                [options]="tecnicos"
                [(ngModel)]="newOrder.tecnico"
                placeholder="Seleccione un Técnico"
                [editable]="true"
                optionLabel="name"
                optionValue="name"
                name="tecnico"
                id="tecnico"
                class="w-full md:w-56"
              ></p-select>
              <label for="material">Técnico Responsable</label>
            </p-iftalabel>
          </div>
        </div>
        <div class="form-buttons">
          <button type="submit" class="btn submit-button">
            Agregar Pedido
          </button>
          <button
            type="button"
            (click)="cancelOrder()"
            class="btn cancel-button"
          >
            Cancelar
          </button>
        </div>
      </form>
    </div>

    <!-- Lista de Pedidos NUEVA-->
    <p-table
      [value]="pedidosList"
      dataKey="id"
      editMode="row"
      [tableStyle]="{ 'min-width': '50rem' }"
    >
      <ng-template #header>
        <tr>
          <th style="width: 20%">Material</th>
          <th style="width: 20%">Cantidad</th>
          <th style="width: 20%">Observación</th>
          <th style="width: 20%">Fecha Solicitada</th>
          <th style="width: 20%">Paquete de Trabajo</th>
          <th style="width: 20%">Técnico</th>
          <th style="width: 20%">Acciones</th>
        </tr>
      </ng-template>
      <ng-template #body let-product let-editing="editing" let-ri="rowIndex">
        <tr [pEditableRow]="product">
          <td>{{ product.material }}</td>
          <td>
            <p-cellEditor>
              <ng-template #input>
                <input
                  pInputText
                  type="text"
                  [(ngModel)]="product.cantidad"
                  required
                />
              </ng-template>
              <ng-template #output>
                {{ product.cantidad }}
              </ng-template>
            </p-cellEditor>
          </td>
          <td>{{ product.observacion }}</td>
          <td>{{ product.fechaSolicitada }}</td>
          <td>{{ product.paqueteTrabajo }}</td>
          <td>{{ product.tecnico }}</td>
          <td>
            <div class="flex items-center justify-center gap-2">
              <button
                *ngIf="!editing"
                pButton
                pRipple
                type="button"
                pInitEditableRow
                icon="pi pi-pencil"
                (click)="onRowEditInit(product)"
                text
                rounded
                severity="secondary"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pSaveEditableRow
                icon="pi pi-check"
                (click)="onRowEditSave(product)"
                text
                rounded
                severity="secondary"
              ></button>
              <button
                *ngIf="editing"
                pButton
                pRipple
                type="button"
                pCancelEditableRow
                icon="pi pi-times"
                (click)="onRowEditCancel(product, ri)"
                text
                rounded
                severity="secondary"
              ></button>
            </div>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Grid de Pedidos -->
  <div class="grid-container">
    <ag-grid-angular
      #myGrid
      style="width: 100%; height: 100%"
      [rowData]="rowData"
      [columnDefs]="columnDefs"
      [defaultColDef]="defaultColDef"
      [rowSelection]="rowSelection"
      [pagination]="true"
      [paginationPageSize]="paginationPageSize"
      [paginationPageSizeSelector]="paginationPageSizeSelector"
      [enableCellTextSelection]="true"
    >
    </ag-grid-angular>
  </div>
</div>
